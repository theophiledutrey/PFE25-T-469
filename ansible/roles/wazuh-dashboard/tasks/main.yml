---

#- name: Check if Wazuh installation directory exists
#  stat:
#    path: /opt/wazuh-install
#  register: wazuh_install_dir

#- name: Check if Wazuh installation script exists
#  stat:
#    path: /opt/wazuh-install/wazuh-install.sh
#  register: wazuh_install_script

#- name: Fail if Wazuh installation script is missing
#  fail:
#    msg: "Wazuh installation script not found. Ensure wazuh-indexer role has run successfully."
#  when: not wazuh_install_dir.stat.exists or not wazuh_install_script.stat.exists


- name: Install Wazuh Dashboard
  command: ./wazuh-install.sh --wazuh-dashboard {{ wazuh_dashboard_node_name | default('dashboard') }} --overwrite
  args:
    chdir: /opt/wazuh-install
    creates: /etc/wazuh-dashboard/opensearch_dashboards.yml
  ignore_errors: "{{ ansible_check_mode }}"